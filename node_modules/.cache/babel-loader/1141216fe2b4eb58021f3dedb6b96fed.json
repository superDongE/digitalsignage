{"ast":null,"code":"import _Reflect$construct from \"@babel/runtime-corejs2/core-js/reflect/construct\";\nimport _regeneratorRuntime from \"@babel/runtime-corejs2/regenerator\";\nimport _objectSpread from \"@babel/runtime-corejs2/helpers/esm/objectSpread\";\nimport _asyncToGenerator from \"@babel/runtime-corejs2/helpers/esm/asyncToGenerator\";\nimport _classCallCheck from \"@babel/runtime-corejs2/helpers/esm/classCallCheck\";\nimport _createClass from \"@babel/runtime-corejs2/helpers/esm/createClass\";\nimport _inherits from \"@babel/runtime-corejs2/helpers/esm/inherits\";\nimport _possibleConstructorReturn from \"@babel/runtime-corejs2/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime-corejs2/helpers/esm/getPrototypeOf\";\n\nfunction _createSuper(Derived) { return function () { var Super = _getPrototypeOf(Derived), result; if (_isNativeReflectConstruct()) { var NewTarget = _getPrototypeOf(this).constructor; result = _Reflect$construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !_Reflect$construct) return false; if (_Reflect$construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Date.prototype.toString.call(_Reflect$construct(Date, [], function () {})); return true; } catch (e) { return false; } }\n\nimport Router from 'next/router';\nimport axios from 'axios';\nimport React from 'react';\nimport { parseCookies, setCookie, destroyCookie } from 'nookies';\nimport { getDisplays } from '../actions/display';\nexport var login = function login(_ref) {\n  var username = _ref.username,\n      password = _ref.password;\n  var host = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : '';\n  var displayId = arguments.length > 2 ? arguments[2] : undefined;\n  return axios.post(host + '/api/v1/user/login', {\n    username: username,\n    password: password\n  }).then(function (res) {\n    if (res && res.data && res.data.success) {\n      Router.push('/layout' + (displayId ? '?display=' + displayId : ''));\n      window.location.href = '/layout' + (displayId ? '?display=' + displayId : '');\n    }\n\n    return res.data;\n  });\n};\nexport var logout = function logout() {\n  var host = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : '';\n  return axios.get(host + '/api/v1/user/logout').then(function (res) {\n    if (res && res.data) {\n      destroyCookie({}, 'loggedIn');\n      Router.push('/login');\n      window.location.href = '/login';\n    }\n\n    return res.data;\n  });\n};\nexport var protect = function protect(Component) {\n  return /*#__PURE__*/function (_React$Component) {\n    _inherits(ProtectedPage, _React$Component);\n\n    var _super = _createSuper(ProtectedPage);\n\n    function ProtectedPage() {\n      _classCallCheck(this, ProtectedPage);\n\n      return _super.apply(this, arguments);\n    }\n\n    _createClass(ProtectedPage, [{\n      key: \"render\",\n      value: function render() {\n        return /*#__PURE__*/React.createElement(Component, this.props);\n      }\n    }], [{\n      key: \"getInitialProps\",\n      value: function () {\n        var _getInitialProps = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(ctx) {\n          var req, res, query, alreadyLoggedIn, host, displayId, displayList, props;\n          return _regeneratorRuntime.wrap(function _callee$(_context) {\n            while (1) {\n              switch (_context.prev = _context.next) {\n                case 0:\n                  req = ctx.req, res = ctx.res, query = ctx.query;\n                  alreadyLoggedIn = parseCookies(ctx).loggedIn;\n                  host = req && req.headers && req.headers.host ? 'http://' + req.headers.host : window.location.origin;\n\n                  if (!(req && req.user || alreadyLoggedIn)) {\n                    _context.next = 22;\n                    break;\n                  }\n\n                  if (!alreadyLoggedIn) {\n                    setCookie(ctx, 'loggedIn', true, {\n                      maxAge: 30 * 24 * 60 * 60,\n                      path: '/'\n                    });\n                  }\n\n                  displayId = query && query.display;\n\n                  if (displayId) {\n                    _context.next = 11;\n                    break;\n                  }\n\n                  _context.next = 9;\n                  return getDisplays(host);\n\n                case 9:\n                  displayList = _context.sent;\n                  displayId = displayList[0]._id;\n\n                case 11:\n                  if (!Component.getInitialProps) {\n                    _context.next = 17;\n                    break;\n                  }\n\n                  _context.next = 14;\n                  return Component.getInitialProps(_objectSpread({}, ctx));\n\n                case 14:\n                  _context.t0 = _context.sent;\n                  _context.next = 18;\n                  break;\n\n                case 17:\n                  _context.t0 = {};\n\n                case 18:\n                  props = _context.t0;\n                  return _context.abrupt(\"return\", _objectSpread({}, props, {\n                    displayId: displayId,\n                    host: host,\n                    loggedIn: true\n                  }));\n\n                case 22:\n                  if (req) {\n                    res.writeHead(302, {\n                      Location: '/login'\n                    });\n                    res.end();\n                  } else {\n                    Router.push('/login');\n                  }\n\n                  return _context.abrupt(\"return\", {});\n\n                case 24:\n                case \"end\":\n                  return _context.stop();\n              }\n            }\n          }, _callee);\n        }));\n\n        function getInitialProps(_x) {\n          return _getInitialProps.apply(this, arguments);\n        }\n\n        return getInitialProps;\n      }()\n    }]);\n\n    return ProtectedPage;\n  }(React.Component);\n};","map":{"version":3,"sources":["C:/Users/82103/Desktop/digitalsignage-master/helpers/auth.js"],"names":["Router","axios","React","parseCookies","setCookie","destroyCookie","getDisplays","login","username","password","host","displayId","post","then","res","data","success","push","window","location","href","logout","get","protect","Component","props","ctx","req","query","alreadyLoggedIn","loggedIn","headers","origin","user","maxAge","path","display","displayList","_id","getInitialProps","writeHead","Location","end"],"mappings":"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","sourcesContent":["import Router from 'next/router'\nimport axios from 'axios'\nimport React from 'react'\nimport { parseCookies, setCookie, destroyCookie } from 'nookies'\n\nimport { getDisplays } from '../actions/display'\n\nexport const login = ({ username, password }, host = '', displayId) => {\n  return axios.post(host + '/api/v1/user/login', { username, password }).then(res => {\n    if (res && res.data && res.data.success) {\n      Router.push('/layout' + (displayId ? '?display=' + displayId : ''))\n      window.location.href = '/layout' + (displayId ? '?display=' + displayId : '')\n    }\n    return res.data\n  })\n}\n\nexport const logout = (host = '') => {\n  return axios.get(host + '/api/v1/user/logout').then(res => {\n    if (res && res.data) {\n      destroyCookie({}, 'loggedIn')\n      Router.push('/login')\n      window.location.href = '/login'\n    }\n    return res.data\n  })\n}\n\nexport const protect = Component =>\n  class ProtectedPage extends React.Component {\n    static async getInitialProps(ctx) {\n      const { req, res, query } = ctx\n      const alreadyLoggedIn = parseCookies(ctx).loggedIn\n      const host =\n        req && req.headers && req.headers.host\n          ? 'http://' + req.headers.host\n          : window.location.origin\n\n      if ((req && req.user) || alreadyLoggedIn) {\n        if (!alreadyLoggedIn) {\n          setCookie(ctx, 'loggedIn', true, {\n            maxAge: 30 * 24 * 60 * 60,\n            path: '/'\n          })\n        }\n\n        let displayId = query && query.display\n\n        if (!displayId) {\n          const displayList = await getDisplays(host)\n          displayId = displayList[0]._id\n        }\n\n        const props = Component.getInitialProps ? await Component.getInitialProps({ ...ctx }) : {}\n        return {\n          ...props,\n          displayId,\n          host,\n          loggedIn: true\n        }\n      } else {\n        if (req) {\n          res.writeHead(302, { Location: '/login' })\n          res.end()\n        } else {\n          Router.push('/login')\n        }\n        return {}\n      }\n    }\n\n    render() {\n      return <Component {...this.props} />\n    }\n  }\n"]},"metadata":{},"sourceType":"module"}